function loadAnalytics(){if(document.getElementById("ga-script"))return;const e=document.createElement("script");function t(){dataLayer.push(arguments)}e.id="ga-script",e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-WW7LC8SFJ5",document.head.appendChild(e),window.dataLayer=window.dataLayer||[],t("js",new Date),t("config","G-WW7LC8SFJ5",{page_path:location.pathname})}function initCookieModal(){const e=localStorage.getItem("cookieConsent"),t=document.getElementById("cookieModal");e?"accepted"===e&&loadAnalytics():t.classList.remove("hidden"),document.getElementById("acceptCookies").addEventListener("click",(()=>{localStorage.setItem("cookieConsent","accepted"),loadAnalytics(),t.classList.add("hidden")})),document.getElementById("denyCookies").addEventListener("click",(()=>{localStorage.setItem("cookieConsent","denied"),t.classList.add("hidden")})),document.getElementById("cookieCloseBtn").addEventListener("click",(()=>{localStorage.setItem("cookieConsent","denied"),t.classList.add("hidden")}))}function setupLegalModals(){document.querySelectorAll("[data-modal]").forEach((e=>{e.addEventListener("click",(()=>{const t=e.getAttribute("data-modal");document.getElementById(t).classList.remove("hidden")}))})),document.querySelectorAll("[data-close]").forEach((e=>{e.addEventListener("click",(()=>{e.closest(".modal").classList.add("hidden")}))}))}window.addEventListener("load",(()=>{initCookieModal(),setupLegalModals();const e=document.getElementById("splash"),t=document.getElementById("splashVideo"),n=document.getElementById("mainContent");e&&t&&n&&(t.autoplay=!0,t.muted=!0,t.setAttribute("playsinline",""),t.setAttribute("webkit-playsinline",""),t.setAttribute("preload","auto"),t.addEventListener("canplaythrough",(()=>{t.play().then((()=>{console.log("â–¶ VÃ­deo reproduciÃ©ndose (mÃ³vil y escritorio)"),t.play().catch((e=>{console.warn("La reproducciÃ³n automÃ¡tica no fue permitida:",e)}))}))})),t.addEventListener("ended",(()=>{e.classList.add("hidden"),e.addEventListener("transitionend",(()=>{e.remove(),n.classList.add("visible")}),{once:!0})})),t.addEventListener("loadedmetadata",(()=>{setTimeout((()=>{e.classList.contains("hidden")||(t.pause(),t.dispatchEvent(new Event("ended")))}),5e3)})))}));const dataKey="fs_positions",defaultPositions={},darkKey="fs_dark",keyStep=10;let state={el:null,sx:0,sy:0,ox:0,oy:0,lt:null};function getRect(){return document.querySelector(".gallery-container").getBoundingClientRect()}function save(){const e={};document.querySelectorAll(".draggable").forEach((t=>{e[t.id]={x:t.offsetLeft,y:t.offsetTop}})),localStorage.setItem(dataKey,JSON.stringify(e))}function load(){const e=JSON.parse(localStorage.getItem(dataKey)||"{}"),t=getRect();document.querySelectorAll(".draggable").forEach((n=>{let o,a;if(null!=e[n.id])o=e[n.id].x,a=e[n.id].y;else{const e=defaultPositions[n.id]||{x:0,y:0};o=e.x,a=e.y}const d=t.width-n.offsetWidth,s=t.height-n.offsetHeight;o=Math.min(Math.max(0,o),d),a=Math.min(Math.max(0,a),s),n.style.left=o+"px",n.style.top=a+"px"}))}function setupLoad(e){e.complete||(e.classList.add("image-loading"),e.onload=()=>e.classList.remove("image-loading"),e.onerror=()=>{e.classList.remove("image-loading"),e.classList.add("image-error")})}function toggleDark(){const e=document.body.classList.toggle("dark");localStorage.setItem(darkKey,e)}function showPop(e){console.log("ðŸ”” showPop invocado para",e.id);const t=document.getElementById("popup");document.getElementById("popupImage").src=e.src,document.getElementById("popupTitle").textContent=e.alt,document.getElementById("popupDescription").textContent=e.dataset.description,t.classList.add("active")}function closePop(){document.getElementById("popup").classList.remove("active")}document.addEventListener("DOMContentLoaded",(()=>{localStorage.removeItem(dataKey);const e={about:{es:"Info",en:"About"},contact:{es:"Contacto",en:"Contact"},aboutTitle:{es:"Sobre Family Style",en:"About Family Style"},contactTitle:{es:"EnvÃ­anos un email",en:"Send us an email"},close:{es:"Cerrar",en:"Close"},aboutInfo:{es:"Family Style es un estudio de diseÃ±o y desarrollo web.",en:"Family Style is a web design and development studio."},pubBtn:{es:"Publicaciones",en:"Publications"},Shangay:{es:"Entrevista Shangay",en:"Shangay Interview"},Telemadrid:{es:"Entrevista Telemadrid",en:"Telemadrid Interview"},Elbloque:{es:"ExposiciÃ³n El Bloque",en:"El Bloque Exhibition"},filterAll:{es:"Antonio Monereo",en:"Antonio Monereo"},filterCopies:{es:"Copias",en:"Copies"},filterPaintings:{es:"Pinturas",en:"Paintings"},filterDrawings:{es:"Dibujos",en:"Drawings"},Sillamoderna:{es:"Silla moderna",en:"Modern Chair"}};function t(t){document.querySelectorAll("[data-i18n]").forEach((n=>{const o=n.getAttribute("data-i18n");e[o]&&(n.textContent=e[o][t])})),localStorage.setItem("lang",t)}let n=localStorage.getItem("lang")||"es";t(n),document.getElementById("langToggle").addEventListener("click",(()=>{n="es"===n?"en":"es",t(n)}));const o=document.getElementById("pubBtn");document.getElementById("pubMenu");o.addEventListener("click",(e=>{e.stopPropagation(),o.parentElement.classList.toggle("open")})),document.addEventListener("click",(()=>{o.parentElement.classList.remove("open")}));const a=Array.from(document.querySelectorAll(".image-gallery .draggable"));function d(e){a.forEach((t=>{t.style.display="all"===e||t.dataset.category===e?"":"none"})),document.querySelectorAll(".filter-btn").forEach((t=>{t.classList.toggle("active",t.dataset.cat===e)}))}document.getElementById("homeBtn").addEventListener("click",(e=>{e.preventDefault(),d("all"),document.body.classList.remove("menu-open"),"undefined"!=typeof bottomSheet&&bottomSheet.classList.remove("open")})),document.querySelectorAll(".filter-btn").forEach((e=>{e.addEventListener("click",(()=>{d(e.dataset.cat),bottomSheet.classList.remove("open")}))})),d("all"),document.querySelectorAll(".sheet-nav").forEach((e=>{e.addEventListener("click",(()=>{switch(e.dataset.action){case"about":document.getElementById("aboutBtn").click();break;case"contact":document.getElementById("contactBtn").click();break;case"dark":document.getElementById("darkModeToggle").click();break;case"reset":document.getElementById("resetBtn").click()}bottomSheet.classList.remove("open")}))}));const s=document.getElementById("resetBtn"),c=document.getElementById("darkModeToggle"),l=document.getElementById("aboutBtn"),i=document.getElementById("aboutSection"),r=document.getElementById("closeAbout"),m=document.getElementById("popup"),u=document.getElementById("closePopup"),g=document.getElementById("hamburgerBtn"),p=document.getElementById("mobileNav");g.addEventListener("click",(()=>{const e="true"===g.getAttribute("aria-expanded");g.setAttribute("aria-expanded",String(!e)),p.hidden=e,document.body.classList.toggle("menu-open",!e),e||p.querySelector('[role="menuitem"]')?.focus(),g.setAttribute("aria-label",e?"Abrir menÃº":"Cerrar menÃº"),g.focus()}));p.querySelectorAll('[role="menuitem"]').forEach((e=>{e.addEventListener("click",(()=>{p.hidden=!0,g.setAttribute("aria-expanded","false"),g.setAttribute("aria-label","Abrir menÃº"),document.body.classList.remove("menu-open"),document.getElementById("gallery")?.focus()}))})),document.querySelectorAll(".mobile-nav-btn[data-filter]").forEach((e=>{e.addEventListener("click",(()=>{d(e.getAttribute("data-filter")),document.body.classList.remove("menu-open")}))})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&"true"===g.getAttribute("aria-expanded")&&g.click()})),document.getElementById("aboutNav").addEventListener("click",(()=>{document.getElementById("aboutBtn").click(),document.body.classList.remove("menu-open")})),document.getElementById("contactNav").addEventListener("click",(()=>{document.getElementById("contactBtn").click(),document.body.classList.remove("menu-open")}));const y=document.getElementById("pubNav"),E=y.parentElement;y.addEventListener("click",(e=>{e.stopPropagation();const t="true"===y.getAttribute("aria-expanded");y.setAttribute("aria-expanded",String(!t)),E.classList.toggle("open")})),document.addEventListener("click",(()=>{E.classList.contains("open")&&(y.setAttribute("aria-expanded","false"),E.classList.remove("open"))}));document.getElementById("homeBtn").addEventListener("click",(()=>{window.scrollTo({top:0,behavior:"smooth"})}));const h=[document.getElementById("searchBtnMobile"),document.getElementById("searchBtnDesktop")].filter(Boolean),f=document.getElementById("searchContainer"),L=document.getElementById("searchForm"),v=document.getElementById("searchInput"),b=Array.from(document.querySelectorAll(".draggable"));h.forEach((e=>{e.addEventListener("click",(e=>{e.stopPropagation(),f.classList.toggle("hidden"),f.classList.contains("hidden")||v.focus()}))})),document.addEventListener("click",(e=>{const t=h.some((t=>t===e.target));f.contains(e.target)||t||f.classList.add("hidden")})),L.addEventListener("submit",(e=>{e.preventDefault();const t=v.value.trim().toLowerCase();b.forEach((e=>{const n=(e.id+" "+e.alt+" "+(e.dataset.description||"")).toLowerCase();e.style.display=n.includes(t)?"":"none"}))})),s.onclick=()=>{localStorage.removeItem(dataKey),document.querySelectorAll(".draggable").forEach((e=>{e.style.left="",e.style.top=""})),load()},"true"===localStorage.getItem(darkKey)&&document.body.classList.add("dark"),c.onclick=toggleDark,l.addEventListener("click",(e=>{e.preventDefault(),i.classList.remove("hidden"),l.setAttribute("aria-expanded","true"),i.setAttribute("aria-hidden","false"),r.focus()})),r.onclick=()=>i.classList.add("hidden");const k=document.getElementById("contactSection"),B=document.getElementById("closeContact"),I=document.getElementById("contactBtn");I.addEventListener("click",(()=>{k.classList.remove("hidden"),I.setAttribute("aria-expanded","true"),w.focus()})),B.addEventListener("click",(()=>{k.classList.add("hidden"),I.setAttribute("aria-expanded","false"),I.focus()}));const w=document.getElementById("sendMailBtn");w.addEventListener("click",(()=>{window.location.href="mailto:antoniomonelopez@gmail.com"})),document.addEventListener("keydown",(e=>{"Escape"!==e.key||k.classList.contains("hidden")||B.click()})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&(i.classList.contains("hidden")||i.classList.add("hidden"),m.classList.contains("active")&&closePop())}));const S=Array.from(document.querySelectorAll(".draggable"));S.forEach((e=>{e.style.position="absolute"})),S.forEach((e=>{const t=getRect(),n=e.getBoundingClientRect();defaultPositions[e.id]={x:n.left-t.left,y:n.top-t.top}})),load();let A=getRect();S.forEach((e=>{setupLoad(e),e.tabIndex=0})),window.addEventListener("resize",(()=>{A=getRect(),load()})),S.forEach((e=>{e.onpointerdown=t=>{"touch"!==t.pointerType&&t.preventDefault(),state.el=e,state.sx=t.clientX,state.sy=t.clientY,state.ox=e.offsetLeft,state.oy=e.offsetTop,e.setPointerCapture(t.pointerId)},e.onpointermove=t=>{if(!state.el)return;let n=state.ox+(t.clientX-state.sx),o=state.oy+(t.clientY-state.sy);console.log(`Moviendo: ${e.id}, X: ${n}, Y: ${o}, R.width: ${A.width}, R.height: ${A.height}`),n=Math.min(Math.max(0,n),A.width-e.offsetWidth),o=Math.min(Math.max(0,o),A.height-e.offsetHeight),e.style.left=`${n}px`,e.style.top=`${o}px`},e.onpointerup=e=>{state.el&&(state.el.style.transform="",save(),state.el.releasePointerCapture(e.pointerId),state.el=null)},e.ondblclick=()=>showPop(e),e.ondblclick=()=>showPop(e),"ontouchstart"in window&&e.addEventListener("click",(t=>{t.stopPropagation(),showPop(e)})),e.onkeydown=t=>{let n=!1,o=e.offsetLeft,a=e.offsetTop;switch(t.key){case"ArrowLeft":o=Math.max(0,o-10),n=!0;break;case"ArrowRight":o=Math.min(A.width-e.offsetWidth,o+10),n=!0;break;case"ArrowUp":a=Math.max(0,a-10),n=!0;break;case"ArrowDown":a=Math.min(A.height-e.offsetHeight,a+10),n=!0;break;case"Enter":case" ":showPop(e)}n&&(t.preventDefault(),e.style.left=`${o}px`,e.style.top=`${a}px`,save())}})),u.onclick=closePop,m.onclick=e=>{e.target===m&&closePop()},document.getElementById("currentYear").textContent=(new Date).getFullYear()}));