function loadAnalytics(){if(document.getElementById("ga-script"))return;const e=document.createElement("script");function t(){dataLayer.push(arguments)}e.id="ga-script",e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-WW7LC8SFJ5",document.head.appendChild(e),window.dataLayer=window.dataLayer||[],t("js",new Date),t("config","G-WW7LC8SFJ5",{page_path:location.pathname})}function initCookieModal(){const e=localStorage.getItem("cookieConsent"),t=document.getElementById("cookieModal");e?"accepted"===e&&loadAnalytics():t.classList.remove("hidden"),document.getElementById("acceptCookies").addEventListener("click",(()=>{localStorage.setItem("cookieConsent","accepted"),loadAnalytics(),t.classList.add("hidden")})),document.getElementById("denyCookies").addEventListener("click",(()=>{localStorage.setItem("cookieConsent","denied"),t.classList.add("hidden")})),document.getElementById("cookieCloseBtn").addEventListener("click",(()=>{localStorage.setItem("cookieConsent","denied"),t.classList.add("hidden")}))}function setupLegalModals(){document.querySelectorAll("[data-modal]").forEach((e=>{const t=e.getAttribute("data-modal"),n=document.getElementById(t),o=n.querySelector("[data-close]");e.addEventListener("click",(t=>{t.preventDefault(),n.classList.remove("hidden"),n.classList.add("active"),e.setAttribute("aria-expanded","true"),o.focus()}))})),document.querySelectorAll("[data-close]").forEach((e=>{const t=e.closest(".modal"),n=t.id&&document.querySelector(`[data-modal="${t.id}"]`);e.addEventListener("click",(()=>{t.classList.remove("active"),t.classList.add("hidden"),n&&n.setAttribute("aria-expanded","false"),n&&n.focus()}))})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&document.querySelectorAll(".modal.active").forEach((e=>{e.classList.remove("active"),e.classList.add("hidden");const t=document.querySelector(`[data-modal="${e.id}"]`);t&&(t.setAttribute("aria-expanded","false"),t.focus())}))}))}window.addEventListener("load",(()=>{const e=document.getElementById("splash"),t=document.getElementById("splashVideo"),n=document.getElementById("mainContent");e&&t&&n&&(t.autoplay=!0,t.muted=!0,t.setAttribute("playsinline",""),t.setAttribute("webkit-playsinline",""),t.setAttribute("preload","auto"),t.addEventListener("canplaythrough",(()=>{t.play().catch((()=>{}))})),t.addEventListener("ended",(()=>{e.addEventListener("transitionend",(()=>{e.remove(),n.classList.add("visible")}),{once:!0}),e.classList.add("hidden")})),t.addEventListener("loadedmetadata",(()=>{setTimeout((()=>{e.classList.contains("hidden")||(t.pause(),t.dispatchEvent(new Event("ended")))}),5e3)})))}));const dataKey="fs_positions",defaultPositions={},darkKey="fs_dark",keyStep=10;let state={el:null,sx:0,sy:0,ox:0,oy:0,lt:null};const DEBUG=!1;function getRect(){return document.querySelector(".gallery-container").getBoundingClientRect()}function save(){const e={};document.querySelectorAll(".draggable").forEach((t=>{e[t.id]={x:t.offsetLeft,y:t.offsetTop}})),localStorage.setItem(dataKey,JSON.stringify(e))}function load(){const e=JSON.parse(localStorage.getItem(dataKey)||"{}"),t=getRect();document.querySelectorAll(".draggable").forEach((n=>{let o,a;if(null!=e[n.id])o=e[n.id].x,a=e[n.id].y;else{const e=defaultPositions[n.id]||{x:0,y:0};o=e.x,a=e.y}const d=t.width-n.offsetWidth,s=t.height-n.offsetHeight;o=Math.min(Math.max(0,o),d),a=Math.min(Math.max(0,a),s),n.style.left=o+"px",n.style.top=a+"px"}))}function setupLoad(e){e.complete||(e.classList.add("image-loading"),e.onload=()=>e.classList.remove("image-loading"),e.onerror=()=>{e.classList.remove("image-loading"),e.classList.add("image-error")})}function toggleDark(){const e=document.body.classList.toggle("dark");localStorage.setItem(darkKey,e)}function showPop(e){console.log("游댒 showPop invocado para",e.id);const t=document.getElementById("popup"),n=document.getElementById("popupImage"),o=document.getElementById("popupTitle"),a=document.getElementById("popupDescription"),d=document.getElementById("detalleLista"),s=e.dataset.popupSrc||e.src;n.src=s,o.textContent=e.alt,a.innerHTML=(e.dataset.description||"").replace(/\n/g,"<br>"),d.innerHTML="";const l=e.dataset.detailStory;if(l){const e=document.createElement("li");e.textContent=l,d.appendChild(e)}else{[`T칠cnica: ${e.dataset.detailTecnica||"No disponible"}`,`Medidas: ${e.dataset.detailMedidas||"No disponible"}`,`A침o de ejecuci칩n: ${e.dataset.detailAno||"No disponible"}`,`Proceso creativo: ${e.dataset.detailProceso||"No disponible"}`,`Inspiraci칩n: ${e.dataset.detailInspiracion||"No disponible"}`].forEach((e=>{const t=document.createElement("li");t.textContent=e,d.appendChild(t)}))}t.classList.add("active")}function closePop(){document.fullscreenElement&&document.exitFullscreen(),document.getElementById("popup").classList.remove("active")}document.addEventListener("DOMContentLoaded",(()=>{initCookieModal(),setupLegalModals(),localStorage.removeItem(dataKey);const e={about:{es:"Info",en:"About"},contact:{es:"Contacto",en:"Contact"},aboutTitle:{es:"Sobre Family Style",en:"About Family Style"},contactTitle:{es:"Env칤anos un email",en:"Send us an email"},close:{es:"Cerrar",en:"Close"},aboutInfo:{es:"Family Style es un estudio de dise침o y desarrollo web.",en:"Family Style is a web design and development studio."},pubBtn:{es:"Publicaciones",en:"Publications"},Shangay:{es:"Entrevista Shangay",en:"Shangay Interview"},Telemadrid:{es:"Entrevista Telemadrid",en:"Telemadrid Interview"},Elbloque:{es:"Exposici칩n El Bloque",en:"El Bloque Exhibition"},filterAll:{es:"Antonio Monereo",en:"Antonio Monereo"},filterCopies:{es:"Copias",en:"Copies"},filterPaintings:{es:"Pinturas",en:"Paintings"},filterDrawings:{es:"Dibujos",en:"Drawings"},Sillamoderna:{es:"Silla moderna",en:"Modern Chair"}};function t(t){document.querySelectorAll("[data-i18n]").forEach((n=>{const o=n.getAttribute("data-i18n");e[o]&&(n.textContent=e[o][t])})),localStorage.setItem("lang",t)}let n=localStorage.getItem("lang")||"es";t(n),document.getElementById("langToggle").addEventListener("click",(()=>{n="es"===n?"en":"es",t(n)}));const o=document.getElementById("pubBtn"),a=(document.getElementById("pubMenu"),document.getElementById("bottomSheet"));o.addEventListener("click",(e=>{e.stopPropagation(),o.parentElement.classList.toggle("open")})),document.addEventListener("click",(()=>{o.parentElement.classList.remove("open")}));const d=Array.from(document.querySelectorAll(".image-gallery .draggable"));function s(e){d.forEach((t=>{t.style.display="all"===e||t.dataset.category===e?"":"none"})),document.querySelectorAll(".filter-btn").forEach((t=>{t.classList.toggle("active",t.dataset.cat===e)}))}document.getElementById("homeBtn").addEventListener("click",(e=>{e.preventDefault(),s("all"),document.body.classList.remove("menu-open"),void 0!==a&&a.classList.remove("open")})),document.querySelectorAll(".filter-btn").forEach((e=>{e.addEventListener("click",(()=>{s(e.dataset.cat),a.classList.remove("open")}))})),s("all"),document.querySelectorAll(".sheet-nav").forEach((e=>{e.addEventListener("click",(()=>{switch(e.dataset.action){case"about":document.getElementById("aboutBtn").click();break;case"contact":document.getElementById("contactBtn").click();break;case"dark":document.getElementById("darkModeToggle").click();break;case"reset":document.getElementById("resetBtn").click()}a.classList.remove("open")}))}));const l=document.getElementById("resetBtn"),c=document.getElementById("darkModeToggle"),i=(document.getElementById("aboutBtn"),document.getElementById("aboutSection"),document.getElementById("closeAbout"),document.getElementById("popup")),r=document.getElementById("closePopup"),m=document.getElementById("hamburgerBtn"),u=document.getElementById("mobileNav");m.addEventListener("click",(()=>{const e="true"===m.getAttribute("aria-expanded");m.setAttribute("aria-expanded",String(!e)),u.hidden=e,document.body.classList.toggle("menu-open",!e),e||u.querySelector('[role="menuitem"]')?.focus(),m.setAttribute("aria-label",e?"Abrir men칰":"Cerrar men칰"),m.focus()}));u.querySelectorAll('[role="menuitem"]').forEach((e=>{e.addEventListener("click",(()=>{u.hidden=!0,m.setAttribute("aria-expanded","false"),m.setAttribute("aria-label","Abrir men칰"),document.body.classList.remove("menu-open"),document.getElementById("gallery")?.focus()}))})),document.querySelectorAll(".mobile-nav-btn[data-filter]").forEach((e=>{e.addEventListener("click",(()=>{s(e.getAttribute("data-filter")),document.body.classList.remove("menu-open")}))})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&"true"===m.getAttribute("aria-expanded")&&m.click()})),document.getElementById("aboutNav").addEventListener("click",(()=>{document.getElementById("aboutBtn").click(),document.body.classList.remove("menu-open")})),document.getElementById("contactNav").addEventListener("click",(()=>{document.getElementById("contactBtn").click(),document.body.classList.remove("menu-open")}));const g=document.getElementById("pubNav"),p=g.parentElement;g.addEventListener("click",(e=>{e.stopPropagation();const t="true"===g.getAttribute("aria-expanded");g.setAttribute("aria-expanded",String(!t)),p.classList.toggle("open")})),document.addEventListener("click",(()=>{p.classList.contains("open")&&(g.setAttribute("aria-expanded","false"),p.classList.remove("open"))}));document.getElementById("homeBtn").addEventListener("click",(()=>{window.scrollTo({top:0,behavior:"smooth"})}));const y=[document.getElementById("searchBtnMobile"),document.getElementById("searchBtnDesktop")].filter(Boolean),E=document.getElementById("searchContainer"),f=document.getElementById("searchForm"),h=document.getElementById("searchInput"),L=Array.from(document.querySelectorAll(".draggable"));y.forEach((e=>{e.addEventListener("click",(e=>{e.stopPropagation(),E.classList.toggle("hidden"),E.classList.contains("hidden")||h.focus()}))})),document.addEventListener("click",(e=>{const t=y.some((t=>t===e.target));E.contains(e.target)||t||E.classList.add("hidden")})),f.addEventListener("submit",(e=>{e.preventDefault();const t=h.value.trim().toLowerCase();L.forEach((e=>{const n=(e.id+" "+e.alt+" "+(e.dataset.description||"")).toLowerCase();e.style.display=n.includes(t)?"":"none"}))})),l.onclick=()=>{localStorage.removeItem(dataKey),document.querySelectorAll(".draggable").forEach((e=>{e.style.left="",e.style.top=""})),load()},"true"===localStorage.getItem(darkKey)&&document.body.classList.add("dark"),c.onclick=toggleDark;const v=Array.from(document.querySelectorAll(".draggable"));v.forEach((e=>{e.style.position="absolute"})),v.forEach((e=>{const t=getRect(),n=e.getBoundingClientRect();defaultPositions[e.id]={x:n.left-t.left,y:n.top-t.top}})),load();let b=getRect();v.forEach((e=>{setupLoad(e),e.tabIndex=0})),window.addEventListener("resize",(()=>{b=getRect(),load()})),v.forEach((e=>{e.onpointerdown=t=>{"touch"!==t.pointerType&&t.preventDefault(),state.el=e,state.sx=t.clientX,state.sy=t.clientY,state.ox=e.offsetLeft,state.oy=e.offsetTop,e.setPointerCapture(t.pointerId)},e.onpointermove=t=>{if(!state.el)return;let n=state.ox+(t.clientX-state.sx),o=state.oy+(t.clientY-state.sy);console.log(`Moviendo: ${e.id}, X: ${n}, Y: ${o}, R.width: ${b.width}, R.height: ${b.height}`),n=Math.min(Math.max(0,n),b.width-e.offsetWidth),o=Math.min(Math.max(0,o),b.height-e.offsetHeight),e.style.left=`${n}px`,e.style.top=`${o}px`},e.onpointerup=e=>{state.el&&(state.el.style.transform="",save(),state.el.releasePointerCapture(e.pointerId),state.el=null)},e.ondblclick=()=>showPop(e),"ontouchstart"in window&&e.addEventListener("click",(t=>{t.stopPropagation(),showPop(e)})),e.onkeydown=t=>{let n=!1,o=e.offsetLeft,a=e.offsetTop;switch(t.key){case"ArrowLeft":o=Math.max(0,o-10),n=!0;break;case"ArrowRight":o=Math.min(b.width-e.offsetWidth,o+10),n=!0;break;case"ArrowUp":a=Math.max(0,a-10),n=!0;break;case"ArrowDown":a=Math.min(b.height-e.offsetHeight,a+10),n=!0;break;case"Enter":case" ":showPop(e)}n&&(t.preventDefault(),e.style.left=`${o}px`,e.style.top=`${a}px`,save())}})),r.onclick=closePop,i.onclick=e=>{e.target===i&&closePop()},document.getElementById("currentYear").textContent=(new Date).getFullYear();const k=document.getElementById("popupImage");k.addEventListener("dblclick",(()=>{document.fullscreenElement?document.exitFullscreen():k.requestFullscreen().catch((e=>{console.error(`Error al pedir fullscreen: ${e.message}`)}))}));let I=0;k.addEventListener("touchend",(e=>{const t=(new Date).getTime(),n=t-I;n<300&&n>0&&(document.fullscreenElement?document.exitFullscreen():k.requestFullscreen().catch((e=>{console.error(`Error al pedir fullscreen: ${e.message}`)}))),I=t}))}));